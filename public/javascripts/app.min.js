"use strict";function configs(n,t){var e=function(n,t,e){function a(n){return 401===n.status?t.error("You are unauthorised to access the requested resource (401)"):404===n.status?t.error("The requested resource could not be found (404)"):500===n.status&&t.error("Internal server error (500)"),e.reject(n)}function s(n){return n}return function(n){return n.then(s,a)}};n.interceptors.push(e),t.debugEnabled(!0)}angular.module("app.config",[]).config(configs),angular.module("app.core",[]),angular.module("todoApplication",["ui.router","ui.bootstrap","app.routes","app.core","app.services","app.config","app.templates"]),angular.module("app.routes",["ui.router"]).config(function(n,t,e){n.state("dashboard",{url:"/",templateUrl:"sections/dashboard/dashboardView.html",controller:"DashboardController as dashboard",authenticate:!0,resolve:{lists:function(n){return n.getAll()}}}).state("login",{url:"/login",templateUrl:"sections/login/loginView.html",controller:"LoginController as login"}).state("register",{url:"/register",templateUrl:"sections/register/registerView.html",controller:"RegisterController as register"}),t.otherwise("/"),e.html5Mode(!0)}).run(function(n,t,e){n.$on("$stateChangeStart",function(n,a){a.authenticate&&!e.isLoggedIn()&&(t.transitionTo("login"),n.preventDefault())})}),angular.module("app.services",[]),angular.module("app.templates",[]).run(["$templateCache",function(n){n.put("components/list/listView.html",'<div class="list-panel">\n    <!-- Header -->\n    <div class="panel-heading">\n        <div class="list-title">\n            <h3 ng-hide="editing" class="panel-title" ng-bind="list.title"></h3>\n            <form class="list-title-form" ng-show="editing" ng-submit="renameList()">\n                <input class="list-title-input" ng-model="list.title">\n            </form>\n        </div>\n        <div class="list-buttons" ng-hide="editing">\n            <a class="list-button-edit" href="#" ng-click="editing = true" aria-label="Edit list">\n                <span class="list-icon-edit" aria-hidden="true"></span>\n            </a>\n        </div>\n    </div>\n    <!-- Details -->\n    <div class="panel-body">\n        <!-- Progress -->\n        <uib-progressbar class="list-progress" value="list.tasks.completed" max="list.tasks.length">\n            {{list.tasks.completed}} / {{list.tasks.length}}\n        </uib-progressbar>\n    </div>\n    <!-- Task items -->\n    <table class="list-items">\n        <tbody>\n        <tr>\n            <td class="task-new" ng-click="addTask()">\n                <a class="task-button-new" href="#" aria-label="New task">\n                    <span class="task-icon-new" aria-hidden="true"></span>\n                </a>\n            </td>\n            <td colspan="2">\n                <form class="task-form" ng-submit="addTask()">\n                    <input class="task-input" ng-model="name" placeholder="New task...">\n                </form>\n            </td>\n        </tr>\n        <tr ng-repeat="task in list.tasks">\n            <td class="task-toggle" ng-click="toggle(task)">\n                <div class="task-completion">\n                    <label>\n                        <input type="checkbox" ng-checked="task.completed" aria-label="Completion"/>\n                    </label>\n                </div>\n            </td>\n            <td>\n                <div ng-class="{\'task-completed\': task.completed}">\n                    <span class="task-name">{{ task.name }}</span>\n                </div>\n            </td>\n\n            <td class="task-delete" ng-click="deleteTask(task)">\n                <a class="task-button-delete" href="#" aria-label="Remove task">\n                    <span class="task-icon-delete" aria-hidden="true"></span>\n                </a>\n            </td>\n        </tr>\n        </tbody>\n    </table>\n</div>'),n.put("components/modal/deleteList.html",'    <div class="modal-header">\n        <h3 class="modal-title" id="modal-title">Delete list</h3>\n    </div>\n    <div class="modal-body" id="modal-body">\n        Are you sure you want to delete list <b>{{ title }}</b>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-danger" type="button" ng-click="dashboard.modal.close()">Delete</button>\n        <button class="btn" type="button" ng-click="dashboard.modal.dismiss()">Cancel</button>\n    </div>'),n.put("components/modal/newList.html",'<form name="newListForm" ng-submit="dashboard.modal.close(listTitle)">\n    <div class="modal-header">\n        <h3 class="modal-title" id="modal-title">New list</h3>\n    </div>\n    <div class="modal-body" id="modal-body">\n        <input class="form-control" ng-model="listTitle" id="title" required/>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-primary" type="sumbit" ng-disabled="newListForm.$invalid">Create</button>\n        <button class="btn" type="button" ng-click="dashboard.modal.dismiss()">Cancel</button>\n    </div>\n</form>'),n.put("sections/dashboard/dashboardView.html",'<nav class="navbar navbar-default navbar-static-top">\n    <div class="container-fluid">\n        <!-- Brand and toggle get grouped for better mobile display -->\n        <div class="navbar-header">\n            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"\n                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">\n                <span class="sr-only">Toggle navigation</span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n            </button>\n            <a class="navbar-brand" href="#">Todo</a>\n        </div>\n\n        <!-- Collect the nav links, forms, and other content for toggling -->\n        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n            <ul class="nav navbar-nav">\n                <li>\n\n                    <a href="#" ng-click="dashboard.openNewListModal()"><span class="glyphicon glyphicon-plus"></span> New</a>\n                </li>\n                <li class="dropdown">\n                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"\n                       aria-expanded="false"><span class="glyphicon glyphicon-trash"></span> Delete<span class="caret"></span></a>\n                    <ul class="dropdown-menu">\n                        <li class="dropdown-submenu" ng-repeat="list in dashboard.lists">\n                            <a href="#" ng-click="dashboard.openDeleteListModal(list)">{{ list.title }}</a>\n                        </li>\n                    </ul>\n                </li>\n            </ul>\n            <ul class="nav navbar-nav navbar-right">\n                <li><a href="#" ng-click="dashboard.logOut()"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>\n            </ul>\n        </div><!-- /.navbar-collapse -->\n    </div><!-- /.container-fluid -->\n</nav>\n\n<div class="container">\n    <div class="row">\n        <div class="col-sm-6 col-md-4" ng-repeat="list in dashboard.lists">\n            <list list="list"></list>\n        </div>\n    </div>\n</div>'),n.put("sections/login/loginView.html",'<div class="container">\n    <div class="page-header">\n        <h1>Todo\n            <small>just in case you forget</small>\n        </h1>\n    </div>\n    <div ng-show="login.error" class="alert alert-danger row">\n        <span>{{ login.error.message }}</span>\n    </div>\n\n    <form name="loginForm"\n          ng-submit="login.sumbit()"\n          style="margin-top:30px;">\n        <h3>Log In</h3>\n\n        <div class="form-group">\n            <input type="text"\n                   class="form-control"\n                   placeholder="Username"\n                   ng-model="login.user.username" required></input>\n        </div>\n        <div class="form-group">\n            <input type="password"\n                   class="form-control"\n                   placeholder="Password"\n                   ng-model="login.user.password" required></input>\n        </div>\n        <button type="submit" class="btn btn-primary" ng-disabled="loginForm.$invalid">Log In</button>\n        <a class="btn btn-default" href="#" ng-click="login.register()">Register</a>\n    </form>\n</div>\n'),n.put("sections/register/registerView.html",'<div class="container">\n    <div class="page-header">\n        <h1>Todo\n            <small>just in case you forget</small>\n        </h1>\n    </div>\n\n    <div ng-show="register.error" class="alert alert-danger row">\n        <span>{{ register.error.message }}</span>\n    </div>\n\n    <form name="registerForm"\n          ng-submit="register.sumbit()"\n          style="margin-top:30px;">\n        <h3>Register</h3>\n\n        <div class="form-group">\n            <input type="text"\n                   class="form-control"\n                   placeholder="Username"\n                   ng-model="register.user.username" required></input>\n        </div>\n        <div class="form-group">\n            <input type="password"\n                   class="form-control"\n                   placeholder="Password"\n                   ng-model="register.user.password" required></input>\n        </div>\n        <button type="submit" class="btn btn-primary" ng-disabled="registerForm.$invalid">Register</button>\n    </form>\n</div>')}]),angular.module("app.services").factory("AuthService",["$http","$window",function(n,t){var e={};return e.saveToken=function(n){t.localStorage["todo-auth-token"]=n},e.getToken=function(){return t.localStorage["todo-auth-token"]},e.isLoggedIn=function(){var n=e.getToken();if(n){var a=JSON.parse(t.atob(n.split(".")[1]));return a.exp>Date.now()/1e3}return!1},e.currentUser=function(){if(e.isLoggedIn()){var n=e.getToken(),a=JSON.parse(t.atob(n.split(".")[1]));return a.username}},e.logIn=function(t){return n.post("/api/login",t).then(function(n){e.saveToken(n.data.token)},function(n){return n.data})},e.register=function(t){return n.post("/api/register",t).then(function(n){e.saveToken(n.data.token)},function(n){return n.data})},e.logOut=function(){t.localStorage.removeItem("todo-auth-token")},e}]),angular.module("app.services").factory("ListService",["$http","AuthService",function(n,t){var e={lists:[]};return e.getAll=function(){return n.get("/api/lists",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(n){return angular.copy(n.data,e.lists),e.lists})},e.addList=function(a){return n.post("/api/lists",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(n){e.lists.push(n.data)})},e.deleteList=function(a){return n.delete("api/list/"+a._id,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(){e.lists.splice(e.lists.indexOf(a),1)})},e.addTask=function(e,a){return n.post("/api/list/"+e._id+"/tasks",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(n){e.tasks.push(n.data)})},e.toggle=function(e){return n.get("/api/list/"+e.list._id+"/task/"+e._id+"/toggle",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(){e.completed^=!0})},e.deleteTask=function(e,a){return n.delete("/api/list/"+e._id+"/task/"+a._id,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(){e.tasks.splice(e.tasks.indexOf(a),1)})},e.renameList=function(e){return n.put("api/list/"+e._id+"/rename",e,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(){})},e}]),angular.module("app.core").controller("DashboardController",function(n,t,e,a,s,o){var l=this;l.lists=a,l.modal=null,l.openNewListModal=function(){console.log("Opening new list modal"),l.modal=n.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"components/modal/newList.html",scope:t}),l.modal.result.then(function(n){console.log("Creating list "+n),s.addList({title:n})},function(){console.log("Modal canceled")})},l.openDeleteListModal=function(e){console.log("Opening delete list modal"),l.modal=n.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"components/modal/deleteList.html",scope:t,controller:function(n,t){n.title=t},resolve:{title:function(){return e.title}}}),l.modal.result.then(function(){console.log("Deleting list "+e.title),s.deleteList(e)},function(){console.log("Modal canceled")})},l.logOut=function(){console.log("Logging out"),o.logOut(),e.go("login")}}),angular.module("app.core").controller("LoginController",function(n,t,e){var a=this;a.user={},a.sumbit=function(){e.logIn(a.user).then(function(n){void 0!==n?a.error=n:t.go("dashboard")})},a.register=function(){t.go("register")}}),angular.module("app.core").controller("RegisterController",function(n,t,e){var a=this;a.user={},a.sumbit=function(){e.register(a.user).then(function(n){void 0!==n?a.error=n:t.go("dashboard")})}}),angular.module("app.core").controller("ListController",["$scope","ListService",function(n,t){n.editing=!1;var e=function(){n.list.tasks.completed=n.list.tasks.filter(function(n){return n.completed}).length};n.toggle=function(n){console.log("Toggling task "+n.name),t.toggle(n).then(function(){e()})},n.deleteTask=function(a){console.log("Removing task "+a.name),t.deleteTask(n.list,a).then(function(){e()})},n.addTask=function(){n.name&&""!==n.name&&(console.log("Adding new task "+n.name),t.addTask(n.list,{name:n.name}),n.name="")},n.renameList=function(){n.list.title&&""!==n.list.title&&(console.log("Renaming list to "+n.list.title),t.renameList(n.list),n.editing=!1)},e()}]),angular.module("app.core").directive("list",function(){return{restrict:"E",scope:{list:"="},templateUrl:"components/list/listView.html",controller:"ListController"}});